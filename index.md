# 組込みシステム総論
## 組込みシステム
- PCの様な形はしていないが、機器に組み込まれるコンピュータ。
  - ハードウェアもソフトウェアも取り外すことはできない。
  - 日常、目にする電気で動作する機器はコンピュータで制御されている。
    - スイッチ、センサなどの入力が多数搭載されている。
    - CPUが演算処理を行う。
    - デジタル信号を外部の出力装置に出力したり、アクチュエーターを使った物理的動作を行う。
    
## 組込みシステムのハードウェア構成
- 基本的な内部構成はPC用のハードウェア構成と変わりはない。
  - コンピュータの五大装置
    - 演算装置・制御装置→CPU
    - 記憶装置→手記憶装置、補助記憶装置
    - 入力装置→スイッチ、タッチパネル、センサー
    - 出力装置→表示装置(LCD・LED)、アクチュエーター、サーボモーター
    - 入出力装置
      - 通信装置→有線・無線LAN、USB
      
## 組込みシステム(Embedded System)
- 専用化されたコンピュータシステム
  - 整合個数は、数個から数100万個
  - 一つの製品に複数のCPUを使うことがある。
    - 自動車には、20〜100個のCPU(ECU)が使われている。
-組込みの応用システム(アプリケーションシステム)
  - スマートフォン(携帯電話)、タブレット、自動車、炊飯器、クーラー等、範囲は広い。
  
## 組込みシステム(プロセッサ)
- 組込みシステム(プロセッサ)が広く使われている理由
  - 汎用性があるため、組込むプログラムにより、全く異なった製品を作ることができる。
  - プログラムの変更で、設計ミスに対応できる。
    - ただし、出荷後では、多額の費用がかかることがある。
  - 組込みシステムで専用回路をソフトウェア化する。
    - 専用回路と同じ動作をさせることが可能である。
    - 回路部品や機構部品の点数を大幅に削減できる。
- 専用回路で十分な機器もある。
  - 個別に開発すると時間がかかる。
  - 設計にミスがあっても変更が容易ではない。

## 組込みシステムの特性
- 専用化されたシステムである。
- 低コストであることが必要である。
- 厳しいリソース制約がある。
  - メモリ容量、重量、サイズ、消費電力
- 高信頼性が要求されている。
  - システム改修に高いコストがかかる。
- リアルタイム性が要求されている。

## 組込みシステムの利点
- コスト低減化と高機能化
- 小型・高信頼性・省電力
- 保守性の向上
  - 機能の変更や追加が可能
- 設計開発期間とコストの低減
- 製造コストの低減
  - 製造工場の規模縮小化
  - 製造工程での人的スキルの低減

## 組込みエンジニア
- メーカー
  - 組込み機器メーカー
  - 組込みソフトウェアメーカー
  - 委託開発や派遣サービス

## 組込みシステムの技術要素
- コンピュータ技術
- ソフトウェア
- 計測、制御技術
- 通信・ネットワーク技術

## 応用システムの例(スマートフォン)
- 機能
  - 音声通話機能
  - メールやWeb接続機能
  - 音楽・動画等の再生・記録機能
  - PCで使われているオフィス機能

## 応用システムで使用されている LSI
- CPU(アプリケーションプロセッサ)
  - スマートフォンではRISC型プロセッサが使われている。
- DSP(Digital Signal Processor)
  - デジタル信号処理専用のプロセッサ
    - 積和演算等を高速に処理できる。
  - 無線通信専用プロセッサ(ベースバンドプロセッサ)
    - 複数の無線システムに対応する。
- ASIC(Application Specific Integrated Circuit)
  - 特定機能向けのLSIであり、ある機能に特化した制御を行うハードウェアも集積している。
  - MPU、メモリ、DSP等を一つのチップに集積する。
    - 小型化・コスト・性能等の高機能化が可能である。
- FPGA(Field Programmable Gate Array)
  - PLD(Programmable Logic Device)の一種で、回路をプログラムで変更できる。
    - HDL(Hardware Description Language)で設計・開発を行う。
    - HDLで記述したライブラリを利用できる。

## 応用システムの構成
- ハードウェア構成
  - アプリケーションプロセッサ(CPU)
    - RICS型プロセッサが使われている。
  - ベースバンドプロセッサ(DSP)等
- 二つのプロセッサを並列に動作させる。
  - 機能を分散する。
  - 時間制約の厳しい処理をユーザインタフェースから分離する。
    - CPUの性能・コストを低減し、低消費電力が期待できる。

## 組込みシステム用 CPU
- 基本的な内部構成はPC用のCPPUと変わりはない。
- CPU(Central Processing Unit)の別名
  - プロセッサ(Processor)
  - マイコン(Micro Computer)
  - MPU(Micro Processing Unit)
  - ECU(Electronic)、主に自動車

## CPUの分類(RISCとCISC)
- RISC(Reduced Instruction Set Computer)
  - 命令数を減らし(Reduced)、CPI(Clock Per Instruction)を低減する。
    - パイプライン下に適している。
  - スマートフォンではARMが主流である。
  - 省電力性能に優れている。
  - 性能向上のため、マルチプロセッサ(マルチコア)技術が使われている。
- CISC(Complex Instruction Set Computer)
  - 複雑な処理(Complex)dめお一つの命令で表す。
    - CPIが増加する。
  - Intel x64、AMD64が主に使われている。
    - 複雑な命令は、複数の単純な命令に置き換えて実行する。
  - 高性能だが消費電力が大きく、冷却装置が必要である。
  - PCも低消費電力が求められているので、マルチプロセッサ(マルチコア)技術が使われている。

## 組込みシステム専用CPUチップの構成
- CPUコア
- 内臓RAM
  - 数kバイト~数100kバイト
- 内臓ROM
  - 一般にフラッシュメモリで構成されている。
  - 数100kバイト〜数Mバイト
- 多種・多数のI/Oインタフェース
  - 省スペース
  - 省電力
- 大量に作ることで安価にできる。
  - 組込むプログラムにより、多様な用途に対応できる。
  - 全てのI/Oインタフェースを使う必要はない。
    - 無駄でも、同じものを作った方が安価にできる。

## 互換性・汎用性
- 以前はそれほど求められなかったが、現在は強く求められるようになってきた。
  - ソフトウェアの大規模化・複雑化が進んでる。
　   - 自動車やスマートフォンでは、500万〜1000万ステップのソフトウェアが搭載されている。
  - ソフトウェア開発の効率化が緊急の課題である。
- 例(スマートフォン)
  - CPUはRAM
  - OSはiOSとAndroid
  
## タイマ(時間管理機能)
- リアルタイム処理に不可欠な時間管理を行うためのハードウェアである。
  - 複数のレジスタで制御されているタイマが組込まれている。
    - 経過時間を測定する。
    - タイマ割込みを発生させる。
- ウォッチドッグタイマ
  - ソフトウェアの状態を監視するタイマである。
  - 指定時間が経過すると割込みを発生する。
    - ソフトウェアで指定時間になる前にタイマをリセットする。

## 省電力制御
- CPU、メモリ、周辺装置等のハードウェアの省電力制御が必要である。
  - 小型化・長時間駆動・冷却簡略化の要求が強い。
- MPUの省電力機能(省電力モード)
  - スタンバイ(スリープ)
    - MPUの命令実行を停止し、割込みにより省電力モードから復帰させる。
- サスペンド(ハイバネート、休止)
  - 動作クロックを停止して安全な停止状態にする。
  - 省電力効果は大きいが、復帰までに時間がかかる。
- メモリの省電力
  - DRAMのリフレッシュを止めて消費電力を抑える。
    - セルフリフレッシュモードの仕組みを使う。
- 周辺装置(デバイス)の省電力
  - デバイス制御レジスタで省電力モードに移行する。
    - デバイスの動作状態が失われ、再初期化が必要になる場合がある。
  - デバイスドライバが省電力モードに移行する前の状態を保持し、復帰後に復元する管理が必要である。

## 組込みソフトウェア
- OSを使用しない場合もある。
  - メモリ容量の制約が厳しい場合。
  - 高いリアルタイム性が求められる場合。
- 機能の一部をハードウェアで実装する。
  - 高速化・高機能化を実現する。
    - ASIC(FPGA)により、CPUと共に1チップに実装する。
  - ハードウェアとソフトウェアの境界が曖昧になってきている。
    - C言語による論理設計も行われている。
    
    



